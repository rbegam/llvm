; REQUIRES: intel_feature_isa_fp16
; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc < %s -mtriple=x86_64-unkown-unkown -mattr=+avx512bw -mattr=+avx512vl -mattr=+avx512fp16 | FileCheck %s

define <16 x half>@test_int_x86_avx512fp16_mask_add_ph_256(<16 x half> %x1, <16 x half> %x2, <16 x half> %src, i16 %mask, <16 x half>* %ptr) {
; CHECK-LABEL: test_int_x86_avx512fp16_mask_add_ph_256:
; CHECK:       # %bb.0:
; CHECK-NEXT:    kmovd	%edi, %k1
; CHECK-NEXT:    vaddph	%ymm1, %ymm0, %ymm3
; CHECK-NEXT:    vmovdqa	%ymm2, %ymm4
; CHECK-NEXT:    vaddph	%ymm1, %ymm0, %ymm4 {%k1}
; CHECK-NEXT:    vaddph	%ymm4, %ymm3, %ymm3
; CHECK-NEXT:    vaddph	%ymm1, %ymm0, %ymm1 {%k1} {z}
; CHECK-NEXT:    vaddph	(%rsi), %ymm0, %ymm2 {%k1}
; CHECK-NEXT:    vaddph	%ymm2, %ymm1, %ymm0
; CHECK-NEXT:    vaddph	%ymm0, %ymm3, %ymm0
; CHECK-NEXT:    retq
  %msk = bitcast i16 %mask to <16 x i1>
  %val = load <16 x half>, <16 x half>* %ptr
  %res0 = fadd <16 x half> %x1, %x2
  %res1 = select <16 x i1> %msk, <16 x half> %res0, <16 x half> %src
  %res2 = select <16 x i1> %msk, <16 x half> %res0, <16 x half> zeroinitializer
  %t3 = fadd <16 x half> %x1, %val
  %res3 = select <16 x i1> %msk, <16 x half> %t3, <16 x half> %src
  %res4  =  fadd <16 x half> %res0 , %res1
  %res5  =  fadd <16 x half> %res2 , %res3
  %res   =  fadd <16 x half> %res4 , %res5
  ret <16 x half> %res
}

define <8 x half>@test_int_x86_avx512fp16_mask_add_ph_128(<8 x half> %x1, <8 x half> %x2, <8 x half> %src, i8 %mask, <8 x half>* %ptr) {
; CHECK-LABEL: test_int_x86_avx512fp16_mask_add_ph_128:
; CHECK:       # %bb.0:
; CHECK-NEXT:    kmovd	%edi, %k1
; CHECK-NEXT:    vaddph	%xmm1, %xmm0, %xmm3
; CHECK-NEXT:    vmovdqa	%xmm2, %xmm4
; CHECK-NEXT:    vaddph	%xmm1, %xmm0, %xmm4 {%k1}
; CHECK-NEXT:    vaddph	%xmm4, %xmm3, %xmm3
; CHECK-NEXT:    vaddph	%xmm1, %xmm0, %xmm1 {%k1} {z}
; CHECK-NEXT:    vaddph	(%rsi), %xmm0, %xmm2 {%k1}
; CHECK-NEXT:    vaddph	%xmm2, %xmm1, %xmm0
; CHECK-NEXT:    vaddph	%xmm0, %xmm3, %xmm0
; CHECK-NEXT:    retq
  %msk = bitcast i8 %mask to <8 x i1>
  %val = load <8 x half>, <8 x half>* %ptr
  %res0 = fadd <8 x half> %x1, %x2
  %res1 = select <8 x i1> %msk, <8 x half> %res0, <8 x half> %src
  %res2 = select <8 x i1> %msk, <8 x half> %res0, <8 x half> zeroinitializer 
  %t3 = fadd <8 x half> %x1, %val
  %res3 = select <8 x i1> %msk, <8 x half> %t3, <8 x half> %src
  %res4  =  fadd <8 x half> %res0 , %res1
  %res5  =  fadd <8 x half> %res2 , %res3
  %res   =  fadd <8 x half> %res4 , %res5
  ret <8 x half> %res
}
